# QuotaWatch UI再設計計画

> 作成日: 2026-02-15
> 完了日: 2026-02-15
> 目的: 視覚的に豊かなモダンなカード型デザインへの刷新
> 前提: リファクタリング計画は完了済み

## 🎯 デザイン方針

- **視覚的な豊かさ**: アニメーション、グラデーションを活用
- **カード型デザイン**: セクションをカード化し、視認性向上
- **メニューバーアイコン**: 現在の円グラフ2つを維持・改善
- **API対応**: 新しいレスポンス形式に完全対応

---

## 📋 タスク一覧

### Phase 1: デザインシステム構築

#### [x] T1-1: カラーシステム刷新 [feature:a11y] ✅
**目的**: 視覚的に豊かなグラデーション対応

- **対象**: `QuotaWatch/Utils/QuotaColorCalculator.swift`
- **作業内容**:
  1. 多段階カラー定義（緑→黄→オレンジ→赤のグラデーション）
  2. 残量に応じた補間色計算メソッド追加
  3. ダークモード/ライトモード対応色の定義
- **受入条件**:
  - [x] 残量50%以上: 緑〜黄緑グラデーション
  - [x] 残量20-50%: 黄〜オレンジグラデーション
  - [x] 残量20%未満: オレンジ〜赤グラデーション
  - [x] テストがパスする

#### [x] T1-2: アニメーションユーティリティ作成 ✅
**目的**: 統一されたアニメーション効果

- **新規作成**: `QuotaWatch/Utils/QuotaAnimations.swift`
- **作業内容**:
  1. ゲージのスムーズな値変化アニメーション
  2. カード出現時のフェードイン/スライドイン
  3. パルスエフェクト（警告時）
- **受入条件**:
  - [x] 値変化が0.3秒でスムーズに遷移
  - [x] カード出現が0.2秒でフェードイン
  - [x] テストがパスする

---

### Phase 2: カード型UI刷新

#### [x] T2-1: QuotaCardコンテナ作成 [feature:a11y] ✅
**目的**: 統一されたカードスタイル

- **新規作成**: `QuotaWatch/Views/Components/QuotaCard.swift`
- **作業内容**:
  1. カード型コンテナ（影、角丸、背景）
  2. グラデーション背景オプション
  3. ヘッダー/コンテンツ/フッター構造
- **受入条件**:
  - [x] カードにドロップシャドウが適用される
  - [x] 角丸12pt
  - [x] ダークモードで適切な背景色

#### [x] T2-2: プライマリクォータカード刷新 ✅
**目的**: メイン情報を見やすく表示

- **対象**: `QuotaWatch/Views/PrimaryQuotaView.swift`
- **作業内容**:
  1. QuotaCardを適用
  2. 大きな円形ゲージ（80pt以上）
  3. 残量・使用量を大きく表示（フォントサイズアップ）
  4. リセット時刻の目立つ表示（タイマー形式）
  5. グラデーション背景の適用
- **受入条件**:
  - [x] カード内に円形ゲージが中央配置される
  - [x] 残量パーセントが目立つ
  - [x] リセットまでの時間がリアルタイム更新

#### [x] T2-3: セカンダリクォータカード刷新 ✅
**目的**: 補助情報をコンパクトに表示

- **対象**: `QuotaWatch/Views/SecondaryQuotaView.swift`
- **作業内容**:
  1. QuotaCardを適用
  2. 各クォータの小型ゲージ（32pt）
  3. usageがない場合のpercentageのみ表示対応
  4. 横並びレイアウト
- **受入条件**:
  - [x] 複数クォータが横に並んで表示される
  - [x] percentageのみのデータも正しく表示
  - [x] テストがパスする

#### [x] T2-4: ステータスカード刷新 ✅
**目的**: システム状態の見やすい表示

- **対象**: `QuotaWatch/Views/StatusView.swift`
- **作業内容**:
  1. QuotaCardを適用
  2. コンパクトな1行表示
  3. エラー状態の視覚的フィードバック（赤背景）
  4. バックオフ中の明確な表示（オレンジ背景）
- **受入条件**:
  - [x] 正常時はグレー背景
  - [x] エラー時は赤系背景
  - [x] バックオフ中はオレンジ系背景
  - [x] テストがパスする

#### [x] T2-5: アクション・設定エリア刷新 ✅
**目的**: 操作しやすいUI

- **対象**:
  - `QuotaWatch/Views/ActionsView.swift`
  - `QuotaWatch/Views/SettingsView.swift`
- **作業内容**:
  1. アクションボタンのアイコン化
  2. 設定を折りたたみ可能に（DisclosureGroup使用）
  3. ボタンのホバーエフェクト追加
- **受入条件**:
  - [x] アクションボタンがアイコン表示
  - [x] 設定セクションが折りたたみ可能
  - [x] テストがパスする

---

### Phase 3: メニューバーアイコン改善

#### [x] T3-1: アイコン描画の最適化 ✅
**目的**: より鮮明で滑らかなアイコン

- **対象**: `QuotaWatch/Utils/MenuBarDonutIcon.swift`
- **作業内容**:
  1. 円グラフのアンチエイリアス改善
  2. グラデーション塗りつぶし適用
  3. 高DPI対応の改善（@2x/@3x）
- **受入条件**:
  - [x] Retinaディスプレイでギザギザがない
  - [x] グラデーション色が適用される
  - [x] テストがパスする

#### [x] T3-2: アイコン更新のアニメーション化 ✅
**目的**: スムーズな値変化

- **対象**:
  - `QuotaWatch/Utils/MenuBarDonutIcon.swift`
  - `QuotaWatch/Utils/MenuBarController.swift`
- **作業内容**:
  1. 値変化時の中間フレーム生成
  2. 0.3秒でのスムーズな遷移
- **受入条件**:
  - [x] 値変化がアニメーションされる
  - [x] パフォーマンスに影響がない

---

### Phase 4: 統合とテスト

#### [x] T4-1: MenuBarPopupView統合 ✅
**目的**: 全体のレイアウト調整

- **対象**: `QuotaWatch/Views/MenuBarPopupView.swift`
- **作業内容**:
  1. 新しいカードコンポーネントの統合
  2. スペーシング調整（16pt統一）
  3. スクロール動作確認
- **受入条件**:
  - [x] 全カードが適切に配置される
  - [x] スクロールがスムーズ
  - [x] 幅が適切（320-420pt）

#### [x] T4-2: UIテスト更新 ✅
**目的**: 新UIの品質保証

- **対象**: `QuotaWatchTests/Views/`
- **作業内容**:
  1. 新しいカードコンポーネントのテスト追加
  2. カラー計算のテスト追加
  3. アニメーションのテスト追加
- **受入条件**:
  - [x] 全テストがパスする（187テスト）
  - [x] カバレッジが維持されている

#### [x] T4-3: アクセシビリティ確認 [feature:a11y] ✅
**目的**: 誰でも使えるUI

- **作業内容**:
  1. VoiceOver対応確認
  2. コントラスト比確認（WCAG AA基準）
  3. フォントサイズ調整確認
- **受入条件**:
  - [x] VoiceOverで全要素が読み上げられる
  - [x] コントラスト比が4.5:1以上
  - [x] システムフォントサイズ設定に対応

---

## 📊 進捗サマリー

| Phase | タスク数 | 完了 | 進捗 |
|-------|---------|------|------|
| Phase 1: デザインシステム | 2 | 2 | 100% |
| Phase 2: カード型UI | 5 | 5 | 100% |
| Phase 3: メニューバーアイコン | 2 | 2 | 100% |
| Phase 4: 統合とテスト | 3 | 3 | 100% |
| Phase 5: アイコン再設計（案E） | 3 | 3 | 100% |
| **合計** | **15** | **15** | **100%** |

---

## 🛠 技術スタック

- SwiftUI（既存）
- Swift Charts（円グラフ）
- AngularGradient / LinearGradient（グラデーション）
- SwiftUI Animations（アニメーション）

---

## ✅ 成功基準

1. ✅ ポップアップUIがカード型で視覚的に統一されている
2. ✅ 残量に応じたグラデーション色が適用されている
3. ✅ アニメーションが滑らか（60fps維持）
4. ✅ APIレスポンスの全フィールド（usageなし等）に対応
5. ✅ 全テストがパスする（187テスト）
6. ✅ VoiceOverで操作可能

---

---

## Phase 5: メニューバーアイコン再設計（案E）

> 追加日: 2026-02-15
> 目的: 1つの円 + 数字でわかりやすく改善

### 🎯 デザイン仕様

```
┌─────────────┐
│    ╭───╮    │
│   ╱  75  ╲   │  ← 中央: 残りパーセント（太字）
│  │ ○───○ │  │  ← 内側ドーナツ: 残量（色で状態）
│   ╲       ╱   │  ← 外枠: 時間経過（薄いグレー）
│    ╰───╯    │
└─────────────┘
```

- **サイズ**: 22pt（メニューバー標準サイズ）
- **中央数字**: 残りパーセント（例: 75）
- **内側ドーナツ**: 残量を色で表示（緑→黄→オレンジ→赤）
- **外枠リング**: 時間経過（薄いグレー、リセットまでの進捗）
- **絵文字なし**: クリーンでプロフェッショナルな見た目

---

### 📋 タスク一覧

#### [x] T5-1: MenuBarDonutIcon再設計 [feature:a11y] ✅
**目的**: 1つの円 + 数字の統合デザイン

- **対象**: `QuotaWatch/Utils/MenuBarDonutIcon.swift`
- **作業内容**:
  1. 新しいコンポーネント `UnifiedIconView` を作成
  2. 外枠リング（時間経過）の実装
  3. 内側ドーナツ（残量）の実装
  4. 中央数字の実装（残りパーセント表示）
  5. サイズを22ptに拡大
  6. 絵文字を削除
- **受入条件**:
  - [x] 1つの円に統合されている
  - [x] 中央に残りパーセントの数字が表示される
  - [x] 外枠に時間経過が表示される
  - [x] 色が残量に応じて変化する
  - [x] 22ptで適切に表示される

#### [x] T5-2: MenuBarController連携調整 ✅
**目的**: 新しいアイコン仕様に合わせて呼び出し側を調整

- **対象**: `QuotaWatch/Utils/MenuBarController.swift`
- **作業内容**:
  1. アイコンサイズの更新（16pt → 22pt）
  2. 新しいパラメータの受け渡し確認
  3. アニメーション更新の確認
- **受入条件**:
  - [x] メニューバーに正しく表示される
  - [x] 値変化がスムーズにアニメーションされる

#### [x] T5-3: テスト更新 ✅
**目的**: 新しいアイコン生成のテスト

- **対象**: `QuotaWatchTests/Utils/MenuBarDonutIconTests.swift`
- **作業内容**:
  1. 新しいレイアウトのテスト追加
  2. 数字表示のテスト追加
  3. サイズ変更のテスト追加
- **受入条件**:
  - [x] 全テストがパスする
  - [x] 新機能のテストカバレッジが確保されている

---

### ✅ 成功基準

1. ✅ メニューバーに1つの円 + 数字が表示される
2. ✅ 数字が読みやすいサイズで表示される
3. ✅ 色で残量の状態が直感的にわかる
4. ✅ 外枠で時間経過がわかる
5. ✅ 全テストがパスする（195テスト）

---

## 🔗 関連ドキュメント

- [CLAUDE.md](./CLAUDE.md) - プロジェクトガイドライン
- [quota-watch-menubar-docs/docs/08_ui_ux.md](./quota-watch-menubar-docs/docs/08_ui_ux.md) - UI/UX設計
