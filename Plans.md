# QuotaWatch UI再設計計画

> 作成日: 2026-02-15
> 完了日: 2026-02-15
> 目的: 視覚的に豊かなモダンなカード型デザインへの刷新

## ✅ 全タスク完了（18/18）

### 実装サマリー

| Phase | 内容 | タスク数 | 状態 |
|-------|------|---------|------|
| Phase 1 | デザインシステム構築（カラーシステム、アニメーション） | 2 | ✅ |
| Phase 2 | カード型UI刷新（QuotaCard、各種ビュー） | 5 | ✅ |
| Phase 3 | メニューバーアイコン改善 | 2 | ✅ |
| Phase 4 | 統合とテスト | 3 | ✅ |
| Phase 5 | アイコン再設計（案E: 1つの円 + 数字 + 外枠） | 3 | ✅ |
| Phase 6 | 2つ並び拡張（残量 + 残り時間） | 3 | ✅ |

### 成功基準

1. ✅ ポップアップUIがカード型で視覚的に統一
2. ✅ 残量に応じたグラデーション色が適用
3. ✅ アニメーションが滑らか
4. ✅ APIレスポンスの全フィールドに対応
5. ✅ 全テストがパス（195テスト）
6. ✅ VoiceOverで操作可能
7. ✅ メニューバーアイコンが「案E」デザインに刷新

### 主な変更ファイル

- `QuotaWatch/Utils/QuotaColorCalculator.swift` - グラデーションカラーシステム
- `QuotaWatch/Utils/QuotaAnimations.swift` - アニメーションユーティリティ（新規）
- `QuotaWatch/Utils/MenuBarDonutIcon.swift` - 統合アイコンデザイン
- `QuotaWatch/Views/Components/QuotaCard.swift` - カードコンテナ（新規）
- `QuotaWatch/Views/PrimaryQuotaView.swift` - プライマリカード刷新
- `QuotaWatch/Views/SecondaryQuotaView.swift` - セカンダリカード刷新
- `QuotaWatch/Views/StatusView.swift` - ステータスカード刷新

### メニューバーアイコン（案E）

```
    ╭───╮
   ╱  75  ╲   ← 残りパーセント（太字）
  │ ○───○ │  ← 内側: 残量（色で状態）
   ╲       ╱   ← 外枠: 時間経過
    ╰───╯
```

---

## Phase 6: メニューバーアイコン拡張（2つ並び）

> 追加日: 2026-02-15
> 目的: 残量と残り時間を2つの円で表示

### 🎯 デザイン仕様

```
  ╭───╮    ╭───╮
 ╱  75  ╲  ╱ 4:32 ╲   ← 中央に数字
 │ ○───○ ││ ○───○ │   ← 内側ドーナツ
  ╲       ╱  ╲       ╱   ← 外枠（進捗）
   ╰───╯    ╰───╯
  残量       残り時間
```

| 項目 | 左側（残量） | 右側（残り時間） |
|------|-------------|-----------------|
| 中央数字 | 75（残り%） | 4:32（残り時間） |
| ドーナツ色 | 緑〜赤（残量に応じて） | 青（時間進捗） |
| 外枠 | 使用率進捗 | 5時間枠の進捗 |

---

### 📋 タスク一覧

#### [x] T6-1: MenuBarDonutIconを2つ並びに拡張 [feature:a11y] ✅
**目的**: 残量と残り時間を並べて表示

- **対象**: `QuotaWatch/Utils/MenuBarDonutIcon.swift`
- **作業内容**:
  1. 左側: 既存の案E（残量）を維持
  2. 右側: 残り時間の円を追加（同デザイン）
  3. 右側の数字を `H:MM` または `M:SS` 形式で表示
  4. 右側の色は青系で統一
  5. 2つの円の間隔を適切に設定
- **受入条件**:
  - [x] 2つの円が横並びで表示される
  - [x] 左側に残量パーセントが表示される
  - [x] 右側に残り時間が表示される
  - [x] 各円にドーナツと外枠が表示される

#### [x] T6-2: 残り時間フォーマット実装 ✅
**目的**: 残り時間を読みやすい形式で表示

- **対象**: `QuotaWatch/Utils/MenuBarDonutIcon.swift`
- **作業内容**:
  1. 残り秒数から `H:MM` または `M:SS` に変換
  2. 5時間以上の場合は `5:00` でクランプ
  3. 0秒以下の場合は `0:00` で表示
- **受入条件**:
  - [x] 1時間以上の場合は `H:MM` 形式
  - [x] 1時間未満の場合は `M:SS` 形式

#### [x] T6-3: テスト更新 ✅
**目的**: 2つ並びデザインのテスト

- **対象**: `QuotaWatchTests/Utils/MenuBarDonutIconTests.swift`
- **作業内容**:
  1. 2つの円が生成されるテスト追加
  2. 残り時間フォーマットのテスト追加
- **受入条件**:
  - [x] 全テストがパスする（19テスト）

---

### ✅ 成功基準

1. ✅ 2つの円が横並びで表示される
2. ✅ 左側に残量（%+ドーナツ+外枠）
3. ✅ 右側に残り時間（H:MM+ドーナツ+外枠）
4. ✅ 全テストがパスする（199テスト）

---

## 🔗 関連ドキュメント

- [CLAUDE.md](./CLAUDE.md) - プロジェクトガイドライン
- [アーカイブ](./.claude/memory/archive/Plans-2026-02-15-ui-redesign.md) - 詳細なタスク情報
